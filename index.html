<!DOCTYPE html>
<html lang="id" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta name="description" content="ABSENSI CLOUD - Sistem Absensi & Penggajian Terintegrasi berbasis Cloud">
    <meta name="keywords" content="absensi, penggajian, karyawan, sistem absensi, aplikasi gaji">
    <meta name="author" content="ABSENSI CLOUD">
    <meta name="theme-color" content="#4361ee">
    <meta name="robots" content="noindex, nofollow"> <!-- Hapus untuk produksi -->
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ABSENSI CLOUD">
    
    <title>ABSENSI CLOUD - Sistem Penggajian Terintegrasi</title>
    
    <!-- Preconnect & Preload untuk performa -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" crossorigin="anonymous">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
          crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon & App Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>" type="image/svg+xml">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <!-- Firebase SDK dengan integrity checks -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js" 
            integrity="sha384-2aD5wNqD2JNnPk9tzqN8BdvylkIe9B42nCbv1F2gOj8oh6lDb0cD3JZyUx6FtUzG" 
            crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js" 
            integrity="sha384-w2h/gwOewM3/hVpN/Cv54y89t6V4mQp2bln3p3rP9ITyN8CD+3jzHe2ID2hmVJyc" 
            crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js" 
            integrity="sha384-LSK8FRhB7g0AQR50OXHl1U1V59DvF3Ybd7hl2mqz9JhTkQ4rXeQlHts8amYhAvkI" 
            crossorigin="anonymous"></script>
    
    <!-- Critical CSS (untuk First Paint cepat) -->
    <style>
        /* Critical CSS untuk loading pertama */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #212529;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4361ee, #7209b7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            text-align: center;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Hide all other screens initially */
        .auth-screen,
        .app-container {
            display: none;
        }
    </style>
</head>
<body class="no-js">
    <noscript>
        <div class="nojs-warning">
            <h2>‚ö†Ô∏è JavaScript Diperlukan</h2>
            <p>Untuk menggunakan ABSENSI CLOUD, harap aktifkan JavaScript di browser Anda.</p>
        </div>
    </noscript>
    
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen" role="status" aria-label="Memuat aplikasi">
        <div class="loading-content">
            <div class="spinner" aria-hidden="true"></div>
            <h2>ABSENSI CLOUD</h2>
            <p>Loading aplikasi...</p>
            <p class="loading-subtext" id="loadingProgress"></p>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen" aria-hidden="true" aria-label="Layar autentikasi">
        <div class="auth-container">
            <div class="auth-header">
                <i class="fas fa-cloud" aria-hidden="true"></i>
                <h1>ABSENSI CLOUD</h1>
                <p>Sistem Absensi & Penggajian Terintegrasi</p>
            </div>
            
            <div class="auth-tabs" role="tablist">
                <button class="tab-btn active" id="loginTabBtn" data-tab="login" role="tab" aria-selected="true" aria-controls="loginPanel">
                    Login
                </button>
                <button class="tab-btn" id="registerTabBtn" data-tab="register" role="tab" aria-selected="false" aria-controls="registerPanel">
                    Register
                </button>
            </div>
            
            <!-- Login Form -->
            <div id="loginPanel" class="auth-tab active" role="tabpanel" aria-labelledby="loginTabBtn">
                <form id="loginForm" novalidate>
                    <div class="form-group">
                        <label for="loginEmail"><i class="fas fa-envelope" aria-hidden="true"></i> Email</label>
                        <input type="email" id="loginEmail" name="email" placeholder="email@example.com" required
                               aria-required="true" autocomplete="email">
                        <div class="validation-error" id="loginEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword"><i class="fas fa-lock" aria-hidden="true"></i> Password</label>
                        <input type="password" id="loginPassword" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required
                               aria-required="true" autocomplete="current-password">
                        <div class="validation-error" id="loginPasswordError"></div>
                    </div>
                    <button type="submit" id="loginBtn" class="btn-auth" aria-label="Login ke sistem">
                        <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Login ke Sistem
                    </button>
                </form>
                <div class="auth-divider">
                    <span>atau login dengan</span>
                </div>
                <button id="googleLoginBtn" class="btn-auth-google" aria-label="Login dengan Google">
                    <i class="fab fa-google" aria-hidden="true"></i> Google Account
                </button>
                <div class="auth-links">
                    <a href="#reset-password" id="forgotPasswordLink" class="text-small">Lupa password?</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerPanel" class="auth-tab" role="tabpanel" aria-labelledby="registerTabBtn" hidden>
                <form id="registerForm" novalidate>
                    <div class="form-group">
                        <label for="registerName"><i class="fas fa-user" aria-hidden="true"></i> Nama Lengkap</label>
                        <input type="text" id="registerName" name="name" placeholder="Nama karyawan" required
                               aria-required="true" autocomplete="name">
                        <div class="validation-error" id="registerNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail"><i class="fas fa-envelope" aria-hidden="true"></i> Email</label>
                        <input type="email" id="registerEmail" name="email" placeholder="email@example.com" required
                               aria-required="true" autocomplete="email">
                        <div class="validation-error" id="registerEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword"><i class="fas fa-lock" aria-hidden="true"></i> Password</label>
                        <input type="password" id="registerPassword" name="password" placeholder="Minimal 6 karakter" required
                               aria-required="true" autocomplete="new-password" minlength="6">
                        <div class="validation-error" id="registerPasswordError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerPosition"><i class="fas fa-briefcase" aria-hidden="true"></i> Posisi/Jabatan</label>
                        <select id="registerPosition" name="position" required aria-required="true">
                            <option value="">Pilih Posisi</option>
                            <option value="staff">Staff</option>
                            <option value="supervisor">Supervisor</option>
                            <option value="manager">Manager</option>
                            <option value="direktur">Direktur</option>
                        </select>
                        <div class="validation-error" id="registerPositionError"></div>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="termsAgreement" name="terms" required aria-required="true">
                            <span>Saya setuju dengan <a href="#terms" target="_blank">Syarat & Ketentuan</a></span>
                        </label>
                        <div class="validation-error" id="termsError"></div>
                    </div>
                    <button type="submit" id="registerBtn" class="btn-auth" aria-label="Daftar akun baru">
                        <i class="fas fa-user-plus" aria-hidden="true"></i> Daftar Akun Baru
                    </button>
                </form>
            </div>
            
            <div class="auth-footer">
                <p><i class="fas fa-info-circle" aria-hidden="true"></i> Data tersimpan aman di Firebase Cloud</p>
                <p class="text-xs">v1.0.0</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container" aria-hidden="true">
        <!-- Skip to main content link (accessibility) -->
        <a href="#mainContent" class="skip-to-content" id="skipToContent">Loncat ke konten utama</a>
        
        <!-- Header -->
        <header class="app-header" role="banner">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle" aria-label="Buka/tutup menu" aria-expanded="false" aria-controls="sidebar">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
                <div class="logo">
                    <i class="fas fa-cloud" aria-hidden="true"></i>
                    <div>
                        <h1>ABSENSI CLOUD</h1>
                        <p class="subtitle">Sistem Penggajian Terintegrasi</p>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="connection-status-indicator" id="connectionStatusIndicator" title="Status koneksi" aria-live="polite"></div>
                
                <div class="user-profile" id="userProfile" role="button" aria-haspopup="true" aria-expanded="false" tabindex="0">
                    <div class="user-info">
                        <span id="userName" class="truncate">Loading...</span>
                        <small id="userPosition" class="truncate">-</small>
                    </div>
                    <div class="user-avatar" aria-hidden="true">
                        <i class="fas fa-user-circle" aria-hidden="true"></i>
                    </div>
                    <div class="user-menu" id="userMenu" role="menu" aria-label="Menu pengguna">
                        <button id="viewProfileBtn" role="menuitem"><i class="fas fa-user" aria-hidden="true"></i> Profil Saya</button>
                        <button id="logoutBtn" role="menuitem"><i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar" role="navigation" aria-label="Menu navigasi utama">
            <div class="sidebar-header">
                <h3><i class="fas fa-tachometer-alt" aria-hidden="true"></i> MENU</h3>
                <button class="sidebar-close" id="sidebarClose" aria-label="Tutup menu">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            
            <ul class="sidebar-menu" role="menubar">
                <li class="active" role="none">
                    <a href="#dashboard" data-page="dashboard" role="menuitem" aria-current="page">
                        <i class="fas fa-home" aria-hidden="true"></i> <span>Dashboard</span>
                    </a>
                </li>
                <li role="none">
                    <a href="#attendance" data-page="attendance" role="menuitem">
                        <i class="fas fa-calendar-check" aria-hidden="true"></i> <span>Absensi</span>
                    </a>
                </li>
                <li role="none">
                    <a href="#salary" data-page="salary" role="menuitem">
                        <i class="fas fa-money-bill-wave" aria-hidden="true"></i> <span>Penggajian</span>
                    </a>
                </li>
                <li role="none">
                    <a href="#kasbon" data-page="kasbon" role="menuitem">
                        <i class="fas fa-hand-holding-usd" aria-hidden="true"></i> <span>Kasbon & Lembur</span>
                    </a>
                </li>
                <li role="none">
                    <a href="#reports" data-page="reports" role="menuitem">
                        <i class="fas fa-chart-bar" aria-hidden="true"></i> <span>Laporan</span>
                    </a>
                </li>
                <li role="none">
                    <a href="#settings" data-page="settings" role="menuitem">
                        <i class="fas fa-cog" aria-hidden="true"></i> <span>Pengaturan</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer" role="contentinfo">
                <div class="connection-status" id="connectionStatus">
                    <i class="fas fa-wifi" aria-hidden="true"></i>
                    <span id="connectionStatusText">Online</span>
                </div>
                <div class="data-info" id="dataSyncInfo">
                    <i class="fas fa-database" aria-hidden="true"></i>
                    <span id="dataSyncStatus">Sync dengan Cloud</span>
                </div>
                <div class="app-version">
                    <i class="fas fa-code-branch" aria-hidden="true"></i>
                    <span>v1.0.0</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent" role="main">
            <!-- Dashboard Page -->
            <section id="dashboardPage" class="page active" role="region" aria-labelledby="dashboardTitle">
                <div class="page-header">
                    <h2 id="dashboardTitle"><i class="fas fa-home" aria-hidden="true"></i> Dashboard</h2>
                    <div class="date-info">
                        <i class="fas fa-calendar" aria-hidden="true"></i>
                        <time id="dashboardDate" datetime="">-</time>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-grid" role="group" aria-label="Statistik bulan ini">
                    <!-- Gaji Card -->
                    <div class="stat-card stat-income" role="article" aria-label="Gaji bulan ini">
                        <div class="stat-icon" aria-hidden="true">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Gaji Bulan Ini</h3>
                            <p class="stat-value" id="currentMonthSalary">Rp 0</p>
                            <small><span id="attendanceDays">0</span> hari kerja</small>
                        </div>
                    </div>
                    
                    <!-- Kehadiran Card -->
                    <div class="stat-card stat-attendance" role="article" aria-label="Statistik kehadiran">
                        <div class="stat-icon" aria-hidden="true">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Kehadiran</h3>
                            <p class="stat-value" id="attendanceRate">0%</p>
                            <small><span id="presentDays">0</span> dari <span id="totalDays">0</span> hari</small>
                        </div>
                    </div>
                    
                    <!-- Lembur Card -->
                    <div class="stat-card stat-overtime" role="article" aria-label="Total lembur">
                        <div class="stat-icon" aria-hidden="true">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Lembur</h3>
                            <p class="stat-value" id="totalOvertime">0 jam</p>
                            <small>Rp <span id="overtimePay">0</span></small>
                        </div>
                    </div>
                    
                    <!-- Kasbon Card -->
                    <div class="stat-card stat-kasbon" role="article" aria-label="Total kasbon">
                        <div class="stat-icon" aria-hidden="true">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Kasbon</h3>
                            <p class="stat-value" id="totalKasbon">Rp 0</p>
                            <small>Sisa: Rp <span id="remainingKasbon">0</span></small>
                        </div>
                    </div>
                </div>
                
                <!-- Today's Quick Actions -->
                <section class="quick-actions" aria-labelledby="quickActionsTitle">
                    <h3 id="quickActionsTitle"><i class="fas fa-bolt" aria-hidden="true"></i> Aksi Cepat Hari Ini</h3>
                    <div class="actions-grid">
                        <button id="quickCheckin" class="action-btn btn-success" aria-label="Check-in sekarang">
                            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                            <span>CHECK-IN</span>
                            <small id="checkinTime">Belum</small>
                        </button>
                        <button id="quickCheckout" class="action-btn btn-primary" aria-label="Check-out sekarang" disabled>
                            <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                            <span>CHECK-OUT</span>
                            <small id="checkoutTime">Belum</small>
                        </button>
                        <button id="quickKasbon" class="action-btn btn-warning" aria-label="Tambah kasbon">
                            <i class="fas fa-money-bill-wave" aria-hidden="true"></i>
                            <span>KASBON</span>
                            <small>Tambah kasbon</small>
                        </button>
                        <button id="quickReport" class="action-btn btn-info" aria-label="Generate laporan">
                            <i class="fas fa-file-export" aria-hidden="true"></i>
                            <span>LAPORAN</span>
                            <small>Export data</small>
                        </button>
                    </div>
                </section>
                
                <!-- Recent Activity -->
                <section class="recent-activity" aria-labelledby="recentActivityTitle">
                    <h3 id="recentActivityTitle"><i class="fas fa-history" aria-hidden="true"></i> Aktivitas Terbaru</h3>
                    <div class="activity-list" id="activityList" role="list">
                        <div class="activity-item" role="listitem">
                            <i class="fas fa-info-circle" aria-hidden="true"></i>
                            <p>Tidak ada aktivitas terbaru</p>
                            <time datetime="">-</time>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Attendance Page (disimpan sebagian untuk hemat ruang) -->
            <section id="attendancePage" class="page" role="region" aria-labelledby="attendanceTitle" hidden>
                <!-- Konten sama seperti sebelumnya, tapi dengan atribut ARIA -->
                <div class="page-header">
                    <h2 id="attendanceTitle"><i class="fas fa-calendar-check" aria-hidden="true"></i> Absensi</h2>
                    <div class="page-actions">
                        <label for="attendanceMonth" class="sr-only">Pilih bulan</label>
                        <select id="attendanceMonth" aria-label="Pilih bulan absensi">
                            <option value="">Pilih Bulan</option>
                        </select>
                        <button class="btn-secondary" id="printAttendance" aria-label="Print absensi">
                            <i class="fas fa-print" aria-hidden="true"></i> Print
                        </button>
                    </div>
                </div>
                <!-- ... sisa konten attendance ... -->
            </section>

            <!-- Salary Page (disimpan sebagian) -->
            <section id="salaryPage" class="page" role="region" aria-labelledby="salaryTitle" hidden>
                <!-- ... konten salary ... -->
            </section>

            <!-- Kasbon Page (disimpan sebagian) -->
            <section id="kasbonPage" class="page" role="region" aria-labelledby="kasbonTitle" hidden>
                <!-- ... konten kasbon ... -->
            </section>

            <!-- Reports Page (disimpan sebagian) -->
            <section id="reportsPage" class="page" role="region" aria-labelledby="reportsTitle" hidden>
                <!-- ... konten reports ... -->
            </section>

            <!-- Settings Page (disimpan sebagian) -->
            <section id="settingsPage" class="page" role="region" aria-labelledby="settingsTitle" hidden>
                <!-- ... konten settings ... -->
            </section>
        </main>
    </div>

    <!-- Modals (simplified) -->
    <div id="photoPreviewModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="photoPreviewTitle">
        <div class="modal-content">
            <h3 id="photoPreviewTitle"><i class="fas fa-camera" aria-hidden="true"></i> Preview Foto</h3>
            <div id="photoPreviewContainer"></div>
            <div class="modal-actions">
                <button class="btn-primary" id="usePhotoBtn">Gunakan Foto</button>
                <button class="btn-secondary" id="retakePhotoBtn">Ambil Ulang</button>
                <button class="btn-danger" id="closePhotoModal">Batal</button>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notifications-container" id="notificationsContainer" role="alert" aria-live="assertive"></div>

    <!-- Scripts -->
    <script>
        // Remove no-js class
        document.documentElement.classList.remove('no-js');
        document.documentElement.classList.add('js');
        
        // Set current year for copyright if needed
        document.addEventListener('DOMContentLoaded', function() {
            const yearElements = document.querySelectorAll('.current-year');
            yearElements.forEach(el => {
                el.textContent = new Date().getFullYear();
            });
        });
    </script>
    
    <script src="firebase-config.js" defer></script>
    <script src="app.js" defer></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registered: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
        
        // Detect online/offline status
        window.addEventListener('online', function() {
            document.getElementById('connectionStatusText').textContent = 'Online';
            document.getElementById('connectionStatusIndicator').className = 'connection-status-indicator online';
        });
        
        window.addEventListener('offline', function() {
            document.getElementById('connectionStatusText').textContent = 'Offline';
            document.getElementById('connectionStatusIndicator').className = 'connection-status-indicator offline';
        });
    </script>
</body>
</html>
